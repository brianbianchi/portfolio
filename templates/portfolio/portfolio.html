{% extends 'core/base.html' %}
{% load humanize %}
{% block title %}{{league.title}}{% endblock %}

{% block content %}
<div class="border-bottom">
    <h1>{{portfolio.name}}</h1>
    <h3 class="mb-2">
        League: <a href="{% url 'view_league' id=portfolio.league.id %}">
            {{portfolio.league.name}}
        </a>
    </h3>
    <p class="mb-1">
        Created {{league.created|naturalday}} by
        <a href="{% url 'user' name=portfolio.user.username %}">
            {{portfolio.user.username}}
        </a>.
    </p>
</div>

{% if user == portfolio.user %}
<a href="{% url 'edit_portfolio' id=portfolio.id %}" class="btn btn-primary my-3" role="button">Edit</a>
<a href="{% url 'delete_portfolio' id=portfolio.id %}" class="btn btn-danger my-3" role="button">Delete</a>
{% endif %}

<h2>Assets</h2>
<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th scope="col">Ticker</th>
            <th scope="col">Quantity</th>
            <th scope="col">Value</th>
            <th scope="col">Total value</th>
            {% if user == portfolio.user %}
            <th scope="col"></th>
            {% endif %}
        </tr>
    </thead>
    <tbody>
        {% for asset in assets %}
        <tr>
            {% if asset.is_currency %}
            <td>Cash / $USD</td>
            <td> </td>
            <td> </td>
            <td>{{asset.value|intcomma}}</td>
            {% else %}
            <td>
                <a href="{% url 'asset' ticker=asset.ticker %}">
                    {{asset.ticker}}
                </a>
            </td>
            <td>{{asset.quantity}}</td>
            <td>${{asset.value|intcomma}}</td>
            <td>${{asset.total_value|intcomma}}</td>
            {% if user == portfolio.user %}
            <td>
                <a href="{% url 'delete_portfolio' id=portfolio.id %}" class="btn btn-danger my-3"
                    role="button">Sell</a>
            </td>
            {% endif %}
            {% endif %}
        </tr>
        {% endfor %}
    </tbody>
</table>

<h2>Transactions</h2>
<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th scope="col">Ticker</th>
            <th scope="col">Quantity</th>
            <th scope="col">Value</th>
            <th scope="col">Total value</th>
        </tr>
    </thead>
    <tbody>
        {% for txn in txns %}
        <tr>
            <td>
                <a href="{% url 'asset' ticker=txn.ticker %}">
                    {{txn.ticker}}
                </a>
            </td>
            <td>{{txn.quantity}}</td>
            {% if txn.is_purchase %}
            <td style="color: green;">
                ${{txn.value|intcomma}}
            </td>
            <td style="color: green;">
                ${{txn.total_value|intcomma}}
            </td>
            {% else %}
            <td style="color: red;">
                ${{txn.value|intcomma}}
            </td>
            <td style="color: red;">
                ${{txn.total_value|intcomma}}
            </td>
            {% endif %}
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}